#!/usr/bin/env bash
# Mock git for testing

# Capture arguments for verification
echo "$@" >> "${BATS_TEST_TMPDIR:-/tmp}/git.calls"

case "$1" in
    config)
        shift
        case "$1" in
            --get)
                case "$2" in
                    user.name) echo "Test User" ;;
                    user.email) echo "test@example.com" ;;
                    *) exit 1 ;;
                esac
                ;;
            --file)
                # git config --file <path> key value - just succeed
                exit 0
                ;;
            user.name|user.email)
                # Setting config - just succeed
                exit 0
                ;;
            *)
                exit 0
                ;;
        esac
        ;;
    init)
        mkdir -p .git
        echo "Initialized empty Git repository in $(pwd)/.git/"
        ;;
    add)
        exit 0
        ;;
    commit)
        echo "[main abc1234] Mock commit"
        exit 0
        ;;
    push)
        echo "Everything up-to-date"
        exit 0
        ;;
    status)
        echo "On branch main"
        echo "nothing to commit, working tree clean"
        ;;
    branch)
        echo "* main"
        ;;
    rev-parse)
        case "$2" in
            --show-toplevel)
                echo "${BATS_TEST_TMPDIR:-/tmp}/repo"
                ;;
            HEAD)
                echo "abc1234567890"
                ;;
            *)
                echo "abc1234"
                ;;
        esac
        ;;
    -C)
        # git -C <path> <command> - recurse with shifted args
        shift 2
        exec "$0" "$@"
        ;;
    clone)
        # git clone <url> [path]
        local dest="${3:-.}"
        mkdir -p "$dest/.git"
        exit 0
        ;;
    *)
        exit 0
        ;;
esac
